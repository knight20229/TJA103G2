<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>商品列表</title>

<!-- Bootstrap CSS -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
	rel="stylesheet" />

<!-- Bootstrap Icons -->
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" />

<!-- Summernote -->
<link
	href="https://cdn.jsdelivr.net/npm/summernote@0.9.0/dist/summernote-lite.min.css"
	rel="stylesheet" />
<!-- Font Awesome Free 6 -->
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

<link rel="stylesheet" th:href="@{/css/product.css}" />
</head>
<body>
	<!-- ========== 左側側邊欄 ========== -->
	<nav class="sidebar">
		<a class="mb-4 fs-4 text-decoration-none fw-bold"
			th:href="@{/back-end}">後台管理</a>

		<div
			class="mb-4 px-3 py-2 bg-light rounded shadow-sm border-start border-4 border-primary">
			<div th:if="${session.employeeId != null}">
				<div class="d-flex align-items-center mb-1">
					<i class="bi bi-person-badge-fill text-primary me-2 fs-5"></i> <span
						class="fw-bold text-dark" th:text="${session.employeeName}">管理員姓名</span>
				</div>
				<div class="text-muted" style="font-size: 0.85rem;">
					ID: <span th:text="${session.employeeId}">0</span>
				</div>
			</div>

			<div th:if="${session.employeeId == null}" class="py-1">
				<i class="bi bi-person-exclamation text-warning me-1"></i> <span
					class="text-muted small">尚未登入系統</span>
			</div>
		</div>

		<ul class="nav flex-column">
			<li class="nav-item"><a class="nav-link fs-5"
				th:href="@{/admin/mem/list}">會員管理</a></li>

			<!-- 折疊選單 -->
			<li class="nav-item fs-5"><a
				class="nav-link d-flex justify-content-between align-items-center "
				data-bs-toggle="collapse" href="#menu_products">商品管理<i
					class="bi bi-chevron-down"></i>
			</a>
				<div class="collapse fs-6 show" id="menu_products">
					<ul class="nav flex-column ms-3">
						<li><a class="nav-link" th:href="@{/prod/listAllProd}">商品列表</a></li>
						<li><a class="nav-link" th:href="@{/prod/addProd}">新增商品</a></li>
					</ul>
				</div></li>

			<!-- 訂單管理 -->
			<li class="nav-item fs-5"><a
				class="nav-link d-flex justify-content-between align-items-center "
				data-bs-toggle="collapse" href="#menu_orders">訂單管理<i
					class="bi bi-chevron-down"></i>
			</a>

				<div class="collapse fs-6" id="menu_orders">
					<ul class="nav flex-column ms-3">
						<li><a class="nav-link" th:href="@{/orders/list}">訂單紀錄</a></li>
						<li><a class="nav-link" th:href="@{/returns/list}">退貨處理</a></li>
					</ul>
				</div></li>
			<!-- 活動管理 -->
			<li class="nav-item fs-5"><a
				class="nav-link d-flex justify-content-between align-items-center "
				data-bs-toggle="collapse" href="#menu_activity">活動管理<i
					class="bi bi-chevron-down"></i>
			</a>

				<div class="collapse fs-6" id="menu_activity">
					<ul class="nav flex-column ms-3">
						<li><a class="nav-link" th:href="@{/coupon/getAllCoupon}">優惠券管理</a></li>
						<li><a class="nav-link"
							th:href="@{/promotions/getAllPromotions}">促銷活動管理</a></li>
					</ul>
				</div></li>
		</ul>

		<div class="mt-4 d-flex justify-content-center logout-wrapper">

			<button th:if="${session.employeeId != null}" type="button"
				class="btn btn-primary w-50 fw-bold btn-logout"
				data-bs-toggle="modal" data-bs-target="#logoutModal">
				<i class="bi bi-box-arrow-right"></i> 登出
			</button>

			<a th:if="${session.employeeId == null}" href="javascript:void(0)"
				th:data-login-url="@{/emp/login}" onclick="loginWithLocation(this)"
				class="btn btn-primary w-50 fw-bold"> <i
				class="bi bi-box-arrow-in-right"></i> 登入
			</a>

		</div>
	</nav>

	<!-- ========== 主內容區 ========== -->
	<main>
		<!-- 麵包屑 -->
		<nav aria-label="breadcrumb" class="d-flex align-items-center mb-3">
			<ol class="breadcrumb mb-0 no-bg me-3 d-flex align-items-center">
				<li class="breadcrumb-item"><a th:href="@{/back-end}"
					class="fs-4 text-primary text-decoration-none fw-bold breadcrumb_index"><i
						class="bi bi-house-door-fill me-1"></i>後台管理</a></li>
				<li class="breadcrumb-item"><a th:href="@{/prod/listAllProd}"
					class="fs-5 text-primary text-decoration-none fw-bold breadcrumb_index">商品管理</a></li>
			</ol>

			<div class="dropdown me-3">
				<button class="btn btn-primary dropdown-toggle fw-bold"
					type="button" id="productDropdown" data-bs-toggle="dropdown">
					<i class="fa-solid fa-list"></i> 商品清單
				</button>
				<ul class="dropdown-menu shadow" aria-labelledby="productDropdown"
					style="max-height: 300px; overflow-y: auto;">
					<th:block th:each="prodVO : ${prodListData}">
						<li><a class="dropdown-item" href="javascript:void(0)"
							th:data-id="${prodVO.productId}" th:text="${prodVO.productName}"
							onclick="scrollToProduct(this)"></a></li>
					</th:block>
				</ul>
			</div>

			<a th:href="@{/prod/addProd}" class="btn btn-primary fw-bold me-3">
				<i class="bi bi-plus-circle"></i> 新增商品
			</a>

			<div class="position-relative" style="width: 280px;">
				<i
					class="fa-solid fa-magnifying-glass position-absolute start-0 top-50 translate-middle-y ms-3"
					style="color: rgba(0, 0, 0, 0.3); font-size: 0.9rem;"></i> <input
					type="text" id="searchInput"
					class="form-control rounded-pill ps-5 pe-5" placeholder="搜尋商品名稱..."
					style="font-weight: 400;">

				<button id="clearSearch"
					class="btn btn-link position-absolute end-0 top-50 translate-middle-y text-decoration-none"
					style="display: none; padding-right: 15px;">
					<i class="fa-solid fa-circle-xmark text-secondary"></i>
				</button>
			</div>

			<button id="clearSearch"
				class="btn btn-link position-absolute end-0 top-50 translate-middle-y text-secondary text-decoration-none"
				style="display: none; padding-right: 15px;">
				<i class="fa-solid fa-circle-xmark"></i>
			</button>
		</nav>
		<hr class="border border-primary border-2" />

		<div th:if="${successMessage}"
			class="alert alert-success alert-dismissible fade show" role="alert">
			<i class="bi bi-check-circle-fill me-2"></i> <span
				th:text="${successMessage}"></span>
			<button type="button" class="btn-close" data-bs-dismiss="alert"
				aria-label="Close"></button>
		</div>

		<div th:if="${errorMessage}"
			class="alert alert-danger alert-dismissible fade show" role="alert">
			<i class="bi bi-exclamation-triangle-fill me-2"></i> <span
				th:text="${errorMessage}"></span>
			<button type="button" class="btn-close" data-bs-dismiss="alert"
				aria-label="Close"></button>
		</div>

		<div class="btn-group mb-3 gap-2">
			<button type="button"
				class="btn btn-outline-primary toggle-btn fw-bold active"
				id="tag_mattress">床墊</button>
			<button type="button"
				class="btn btn-outline-primary toggle-btn fw-bold active"
				id="tag_frame">床架</button>
		</div>
		<!-- 商品卡片 -->
		<div class="container mt-4">
			<div class="row g-4 justify-content-start" id="product-list">
				<th:block th:each="prodVO : ${prodListData}">
					<div class="col-lg-4 col-md-6 product-item"
						th:data-type="${prodVO.productType}">
						<div class="card border-0 product_bg h-100"
							th:classappend="${!prodVO.status} ? 'opacity-50 shadow-none' : 'shadow-sm'">
							<div
								class="product-img-container position-relative overflow-hidden">
								<img
									th:src="@{/prod/DBImgReader(productId=${prodVO.productId})}"
									class="card-img-top img-fluid" alt="商品圖片"
									style="height: 250px; width: 100%; object-fit: cover; background-color: #f8f9fa;" />

								<img th:unless="${prodVO.productId != null}"
									th:src="@{/images/no-image.png}"
									class="card-img-top img-fluid default-img" alt="暫無圖片" />

								<div
									class="product-overlay d-flex align-items-center justify-content-center">
									<a
										th:href="@{/prod/getOne_For_Display(productId=${prodVO.productId})}"
										class="btn btn-light fw-bold shadow-sm px-4 py-2"> <i
										class="bi bi-eye me-1"></i>檢視詳情
									</a>
								</div>
							</div>

							<div class="card-body text-start">
								<div
									class="d-flex justify-content-between align-items-center mb-2">
									<span class="text-secondary small fw-bold">ID:
										#[[${prodVO.productId}]]</span> <span
										th:if="${prodVO.productType == false or prodVO.productType == '床墊'}"
										class="badge rounded-pill bg-warning text-dark px-3">床墊</span>

									<span
										th:if="${prodVO.productType == true or prodVO.productType == '床架'}"
										class="badge rounded-pill bg-info text-dark px-3">床架</span>
								</div>

								<p class="card-title fw-bold mb-1">
									<span th:text="${prodVO.productName}"></span>
								</p>

								<p class="card-text mb-3">
									<small class="text-muted">狀態：</small> <span
										th:id="'status-text-' + ${prodVO.productId}"
										th:class="${prodVO.status ? 'text-success fw-bold' : 'text-danger fw-bold'}"
										th:text="${prodVO.status ? '● 上架中' : '● 已下架'}"> </span>
								</p>

								<div class="d-flex justify-content-between gap-2">
									<form method="post" th:action="@{/prod/getOne_For_Update}"
										class="w-50">
										<input type="hidden" name="productId"
											th:value="${prodVO.productId}">
										<button type="submit"
											class="btn btn-primary btn-reverse w-100 fw-bold">
											<i class="bi bi-pencil-square me-1"></i>編輯商品
										</button>
									</form>

									<form method="get" th:action="@{/prod/setSizes}" class="w-50">
										<input type="hidden" name="productId"
											th:value="${prodVO.productId}">
										<button type="submit"
											class="btn btn-success btn-reverse-success w-100 fw-bold">
											<i class="bi bi-box-seam me-1"></i>編輯庫存
										</button>
									</form>
								</div>
							</div>
						</div>
					</div>
				</th:block>
			</div>
		</div>
		<div id="toast-wrapper"
			class="toast-container position-fixed bottom-0 end-0 p-3"
			style="z-index: 1080;"></div>

		<!--登出確認Model -->
		<div class="modal fade" id="logoutModal" tabindex="-1"
			aria-labelledby="logoutModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="logoutModalLabel">確認登出</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
					</div>
					<div class="modal-body">你確定要登出嗎？</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary"
							data-bs-dismiss="modal">取消</button>
						<button type="button" class="btn btn-danger"
							th:onclick="|window.location.href='@{/emp/logout}'|">
							確定登出</button>
					</div>
				</div>
			</div>
		</div>

	</main>

	<!-- JS 套件 -->
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
	<script th:src="@{/js/product_listAll.js}"></script>
</body>
</html>
