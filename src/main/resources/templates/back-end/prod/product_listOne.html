<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>後台管理 - 商品查詢</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
    />

    <link rel="stylesheet" th:href="@{/css/product.css}" />
  </head>
  <body>
    <!-- ========== 左側側邊欄 ========== -->
    <nav class="sidebar">
      <a class="mb-4 fs-4 text-decoration-none fw-bold" th:href="@{/back-end}">後台管理</a>

      <ul class="nav flex-column">
        <li class="nav-item">
          <a class="nav-link fs-6" th:href="@{/admin/mem/list}">會員管理</a>
        </li>

        <!-- 折疊選單 -->
        <li class="nav-item fs-6">
          <a
            class="nav-link d-flex justify-content-between align-items-center "
            data-bs-toggle="collapse"
            href="#menu_products"
          >商品管理<i class="bi bi-chevron-down"></i>
          </a>
          <div class="collapse show" id="menu_products">
            <ul class="nav flex-column ms-3">
              <li>
                <a class="nav-link" th:href="@{/prod/listAllProd}">商品列表</a>
              </li>
              <li>
                <a class="nav-link" th:href="@{/prod/addProd}">新增商品</a>
              </li>
            </ul>
          </div>
        </li>
        

        <li class="nav-item fs-6" ><a class="nav-link" href="#">訂單管理</a></li>
        <!-- 活動管理 -->
        <li class="nav-item fs-6">
          <a
            class="nav-link d-flex justify-content-between align-items-center "
            data-bs-toggle="collapse"
            href="#menu_activity"
          >活動管理<i class="bi bi-chevron-down"></i>
          </a>

          <div class="collapse show" id="menu_activity">
            <ul class="nav flex-column ms-3">
              <li>
                <a class="nav-link" th:href="@{/coupon/getAllCoupon}">優惠券管理</a>
              </li>
              <li>
                <a class="nav-link" th:href="@{/promotions/getAllPromotions}">促銷管理</a>
              </li>
            </ul>
          </div>
        </li>
        <li class="nav-item fs-6"><a class="nav-link" href="#">客服管理</a></li>
      </ul>

      <div class="mt-4 d-flex justify-content-center logout-wrapper">
        <button class="btn btn-outline-primary w-50 fs-6 btn-logout fw-bold" ><i class="bi bi-box-arrow-right "></i> 登出</button>
      </div>
    </nav>

    <!-- ========== 主內容區 ========== -->
    <main th:inline="text">
      <!-- 麵包屑 -->
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb d-flex align-items-center no-bg">
          <li class="breadcrumb-item">
            <a th:href="@{/prod/listAllProd}" class="fs-5 text-primary text-decoration-none fw-bold breadcrumb_index">商品管理</a>
          </li>
          <li class="breadcrumb-item active">商品查詢</li>
        </ol>
      </nav>
      
      <section>
	      	<div class="row">
	        <!-- 左半：圖片 + 描述 + 尺寸 -->
		        <div class="col-md-6">
					<div class="mb-4">
						<img id="previewImg" 
						     th:if="${prodVO.productId != null}"
						     th:src="@{/prod/DBImgReader(productId=${prodVO.productId})}" 
						     class="img-preview mb-2" 
						     style="max-width: 100%; height: auto; border: 1px solid #ddd; display: block;"/>
				    </div>
				    <div class="p-3 bg-light border rounded">
				        <label class="form-label fw-bold">商品介紹：</label>
				        <div th:utext="${prodVO.description}">這裡會顯示商品描述</div>
			    	</div>
			    </div>
		  
        <!-- 右半：表單欄位 -->
        <div class="col-md-6">
            <!-- 商品編號 -->
			<div class="mb-3 d-flex align-items-center">
		        <label class="form-label fw-bold mb-0">商品編號：</label>
		        <span class="text-secondary ms-2" th:text="${prodVO.productId}"></span>
		    </div>

            <!-- 商品名稱 -->
			<div class="mb-3 d-flex align-items-center">
		        <label class="form-label fw-bold mb-0">商品名稱：</label>
		        <span class="fw-bold fs-5 text-primary ms-2" th:text="${prodVO.productName}"></span>
		        <input type="hidden" name="productId" th:value="${prodVO.productId}" />
		    </div>

            <!-- 商品類型 -->
            <div class="mb-3">
			  <label class="form-label fw-bold">商品類型：
			    <span th:text="${prodVO.productType} ? '床架' : '床墊'" 
			          class="badge bg-secondary fs-6">
			    </span>
			  </label>
			  <input type="hidden" name="productType" th:value="${prodVO.productType}" />
		    </div>
		    
            <!-- 商品材質 -->
		    <div class="mb-3">
			    <label class="form-label fw-bold">商品材質：</label>
			        <span class="text-dark fw-bold" th:text="${prodVO.material}"></span>
			</div>
			
			<!-- 商品功能 -->
			<div class="mb-4">
			    <label class="form-label fw-bold d-block">商品功能：</label>
			    <div class="d-flex flex-wrap gap-2">
			        <th:block th:each="feat : ${prodVO.features}">
			            <span class="badge border border-primary text-primary px-2 py-1 bg-white">
			                <i class="bi bi-check2"></i> 
			                <span th:text="${feat.featureName}">功能名稱</span>
			            </span>
			        </th:block>
			    </div>
			</div>
			<!-- 商品尺寸 -->
			<div class="mb-3">
			    <label class="form-label fw-bold">商品尺寸（寬度）：</label>
			    <div class="col-5">
			        <select class="form-select" id="width_selector" name="currentWidth">
			            <option value="">請選擇寬度</option>
			            <option th:each="width : ${distinctWidths}" th:value="${width}">
			                <span th:switch="${width}">
			                    <span th:case="90">單人床 寬 90cm</span>
			                    <span th:case="105">單人床加大 寬 105cm</span>
			                    <span th:case="120">單人床加大(歐規) 寬 120cm</span>
			                    <span th:case="150">雙人床 寬 150cm</span>
			                    <span th:case="180">雙人床加大 寬 180cm</span>
			                    <span th:case="*" th:text="${width} + 'cm'"></span>
			                </span>
			            </option>
			        </select>
			    </div>
			</div>

			<div class="mb-3">
			    <label class="form-label fw-bold">規格明細：</label>
			    
			    <div th:each="width : ${distinctWidths}" 
			         th:id="'width_group_' + ${width}" 
			         class="size_group" 
			         style="display: none;">
			        
			        <div class="row g-2 align-items-center mb-2 size_row">
			            <div class="col-auto fw-bold" style="width: 100px;">標準 188cm</div>
			            <th:block th:each="size : ${allSizes}" th:if="${size.width == width && size.length == 188}">
			                <input type="hidden" name="sizeId" th:value="${size.sizeId}" />
			                <div class="col-2">
			                    <span class="fw-bold" 
                  					th:text="${configMap != null && configMap[size.sizeId] != null ? '庫存:' + configMap[size.sizeId].stock : '庫存:0'}">
            					</span>
			                </div>
			                <div class="col-3">
			                    <span class="text-primary fw-bold" 
				                    th:text="${configMap != null && configMap[size.sizeId] != null ? '$' + configMap[size.sizeId].price : '未定價'}">
					            </span>
			                </div>
			            </th:block>
			        </div>
			
			        <div class="row g-2 align-items-center mb-2 size_row">
			            <div class="col-auto fw-bold" style="width: 100px;">歐規 200cm</div>
			            <th:block th:each="size : ${allSizes}" th:if="${size.width == width && size.length == 200}">
			                <input type="hidden" name="sizeId" th:value="${size.sizeId}" />
			                <div class="col-2">
			                    <span class="fw-bold" 
                  					th:text="${configMap != null && configMap[size.sizeId] != null ? '庫存:' + configMap[size.sizeId].stock : '庫存:0'}">
            					</span>
			                </div>
			                <div class="col-3">
			                    <span class="text-primary fw-bold" 
				                    th:text="${configMap != null && configMap[size.sizeId] != null ? '$' + configMap[size.sizeId].price : '未定價'}">
					            </span>
			                </div>
			            </th:block>
			        </div>
			
			        <div class="row g-2 align-items-center mb-2 size_row">
			            <div class="col-auto fw-bold" style="width: 100px;">加長 210cm</div>
			            <th:block th:each="size : ${allSizes}" th:if="${size.width == width && size.length == 210}">
			                <input type="hidden" name="sizeId" th:value="${size.sizeId}" />
			                <div class="col-2">
			                    <span class="fw-bold" 
                  					th:text="${configMap != null && configMap[size.sizeId] != null ? '庫存:' + configMap[size.sizeId].stock : '庫存:0'}">
            					</span>
			                </div>
			                <div class="col-3">
			                    <span class="text-primary fw-bold" 
				                    th:text="${configMap != null && configMap[size.sizeId] != null ? '$' + configMap[size.sizeId].price : '未定價'}">
					            </span>
			                </div>
			            </th:block>
			        </div>
			    </div>
			    
			    <div id="no_width_msg" class="text-muted small py-3">請先選擇上方寬度以設定規格內容</div>
			</div>

				<div class="mt-5 d-flex gap-3">
				    <form th:action="@{/prod/getOne_For_Update}" method="post">
				        <input type="hidden" name="productId" th:value="${prodVO.productId}">
				        <button type="submit" class="btn btn-primary btn-reverse px-4 fw-bold">
				            <i class="bi bi-pencil-square me-1"></i>修改商品
				        </button>
				    </form>
				
				    <form th:action="@{/prod/setSizes}" method="get">
				        <input type="hidden" name="productId" th:value="${prodVO.productId}">
				        <button type="submit" class="btn btn-success btn-reverse-success px-4 fw-bold">
				            <i class="bi bi-box-seam me-1"></i>修改庫存
				        </button>
				    </form>
				
				    <a th:href="@{/prod/listAllProd}" class="btn btn-outline-secondary px-4 fw-bold">
				        <i class="bi bi-arrow-left me-1"></i>返回列表
				    </a>
				</div>
 			</div>
    	</section>
      
    </main>

    <!-- JS 套件 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/js/product_save.js}"></script>
<script th:inline="javascript">
    /*<![CDATA[*/
    var allSizes = /*[[${allSizes}]]*/ [];
    console.log("尺寸資料已載入");
    /*]]>*/
</script>
  </body>
</html>
