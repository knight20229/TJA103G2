<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>商品查詢</title>

<!-- Bootstrap CSS -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
	rel="stylesheet" />

<!-- Bootstrap Icons -->
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" />

<link rel="stylesheet" th:href="@{/css/product.css}" />
<link rel="icon" th:href="@{/images/dreamhouseb.ico}">
<link rel="stylesheet"
	th:href="@{https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css}">
<link rel="stylesheet" th:href="@{/css/vendors.css}">
<link rel="stylesheet" th:href="@{/css/style.css}">
<link rel="stylesheet" th:href="@{/css/cart.css}">
</head>
<body>
<!-- ================= Header ================= -->
	<div
		class="header-area header-area--default header-area--default--white header-sticky">

		<div
			class="header-navigation-area header-navigation-area--white header-navigation-area--extra-space d-none d-lg-block">
			<div class="container wide">
				<div class="row">
					<div class="col-lg-12">

						<div class="header-info-wrapper header-info-wrapper--alt-style">

							<div class="header-logo">
								<a th:href="@{/}"> <img th:src="@{/images/logo.png}"
									class="img-fluid" alt="">
								</a>
							</div>

							<div class="header-navigation-wrapper">
								<nav>
									<ul>
										<li><a th:href="@{/product/list}">商品瀏覽</a></li>
										<li><a th:href="@{/compare}">商品比較</a></li>
										<li><a th:href="@{/custom}">客製化商品</a></li>
										<li><a th:href="@{/article}">好眠知識</a></li>
									</ul>
								</nav>
							</div>

							<nav class="navbar navbar-expand-lg navbar-light bg-light">
								<div class="container-fluid">
									<form class="d-flex" th:action="@{/product/search}"
										method="get">
										<input class="form-control me-2" type="search" name="keyword"
											placeholder="搜尋商品">
										<button class="btn btn-outline-success" type="submit">Search</button>
									</form>
								</div>
							</nav>

							<div class="header-icon-area">
								<ul class="header-icon__list">
									<li><i class="fa-solid fa-message" style="color: #B197FC"></i></li>
									<li><i class="fa-solid fa-user" style="color: #B197FC"></i></li>
									<li><i class="fa-solid fa-bell" style="color: #B197FC"></i></li>
									<li><a th:href="@{/cart/getCart(memberId=${session.memberId})}"> <i
											class="fa-solid fa-cart-shopping" style="color: #B197FC"></i>
									</a></li>
								</ul>
							</div>

						</div>

					</div>
				</div>
			</div>
		</div>
	</div>

<!-- ================= Main ================= -->
		<div class="text-center text-muted mb-2">
			<small>目前 Session ID: <span th:text="${session.memberId}">無</span></small>
		</div>
		<div>
			<span th:text="${message}"></span>
		</div>
		<section>
			<form class="" th:action="@{/cart/addSTD}" method="post">
			<div class="row">
				<!-- 左半：圖片 + 描述 + 尺寸 -->
				<div class="col-md-6">
					<div class="mb-4">
						<img id="previewImg" th:if="${prodVO.productId != null}"
							th:src="@{/prod/DBImgReader(productId=${prodVO.productId})}"
							class="img-preview mb-2"
							style="max-width: 100%; height: auto; border: 1px solid #ddd; display: block;" />
					</div>
					<div class="p-3 bg-light border rounded">
						<label class="form-label fw-bold">商品介紹：</label>
						<div th:utext="${prodVO.description}">這裡會顯示商品描述</div>
					</div>
				</div>

				<!-- 右半：表單欄位 -->
				<div class="col-md-6">
					<!-- 商品編號 -->
					<div class="mb-3 d-flex align-items-center">
						<label class="form-label fw-bold mb-0">商品編號：</label> <span
							class="text-secondary ms-2 fw-bold" th:text="${prodVO.productId}"></span>
					</div>

					<!-- 商品名稱 -->
					<div class="mb-3 d-flex align-items-center">
						<label class="form-label fw-bold mb-0">商品名稱：</label> <span
							class="fw-bold fs-5 text-primary ms-2"
							th:text="${prodVO.productName}"></span> <input type="hidden"
							name="productId" th:value="${prodVO.productId}" />
					</div>

					<!-- 商品類型 -->
					<div class="mb-3">
					    <label class="form-label fw-bold">商品類型： 
					        <span th:text="${prodVO.productType} ? '床架' : '床墊'"
					              class="badge fs-6 fw-bold px-2 py-1"
					              th:classappend="${prodVO.productType} ? 'bg-info text-dark' : 'bg-warning text-dark'">
					        </span>
					    </label> 
					    <input type="hidden" name="productType" th:value="${prodVO.productType}" />
					</div>

					<!-- 商品材質 -->
					<div class="mb-3">
						<label class="form-label fw-bold">商品材質：</label> <span
							class="text-dark fw-bold" th:text="${prodVO.material}"></span>
					</div>

					<!-- 商品功能 -->
					<div class="mb-4">
						<label class="form-label fw-bold d-block">商品功能：</label>
						<div class="d-flex flex-wrap gap-2">
							<th:block th:each="feat : ${prodVO.features}">
								<span
									class="badge border border-primary text-primary px-2 py-1 bg-white">
									<i class="bi bi-check2"></i> <span
									th:text="${feat.featureName}">功能名稱</span>
								</span>
							</th:block>
						</div>
					</div>
					<!-- 商品尺寸 -->
					<div class="mb-3">
						<label class="form-label fw-bold">商品尺寸（寬度）：</label>
						<div class="col-5">
							<select class="form-select" id="width_selector"
								name="currentWidth">
								<option value="">請選擇寬度</option>
								<option th:each="width : ${distinctWidths}" th:value="${width}">
									<th:block th:switch="${width}">
								        <th:block th:case="90">單人床 寬 90cm</th:block>
								        <th:block th:case="105">單人床加大 寬 105cm</th:block>
								        <th:block th:case="120">單人床加大(歐規) 寬 120cm</th:block>
								        <th:block th:case="150">雙人床 寬 150cm</th:block>
								        <th:block th:case="180">雙人床加大 寬 180cm</th:block>
								        <th:block th:case="*" th:text="${width} + 'cm'"></th:block>
								    </th:block>
								</option>
							</select>
						</div>
					</div>

<!-- 					<div class="mb-3"> -->
<!-- 						<label class="form-label fw-bold">規格明細：</label> -->

<!-- 						<div th:each="width : ${distinctWidths}" -->
<!-- 							th:id="'width_group_' + ${width}" class="size_group" -->
<!-- 							style="display: none;"> -->

<!-- 							<div class="row g-2 align-items-center mb-2 size_row"> -->
<!-- 								<div class="col-auto fw-bold" style="width: 100px;">標準 -->
<!-- 									188cm</div> -->
<!-- 								<th:block th:each="size : ${allSizes}" -->
<!-- 									th:if="${size.width == width && size.length == 188}"> -->
<!-- 									<input type="hidden" name="sizeId" th:value="${size.sizeId}" /> -->
<!-- 									<div class="col-2"> -->
<!-- 										<span class="fw-bold" -->
<!-- 											th:text="${configMap != null && configMap[size.sizeId] != null ? '庫存:' + configMap[size.sizeId].stock : '庫存:0'}"> -->
<!-- 										</span> -->
<!-- 									</div> -->
<!-- 									<div class="col-3"> -->
<!-- 										<span class="text-primary fw-bold" -->
<!-- 											th:text="${configMap != null && configMap[size.sizeId] != null ? '$' + configMap[size.sizeId].price : '未定價'}"> -->
<!-- 										</span> -->
<!-- 									</div> -->
<!-- 								</th:block> -->
<!-- 							</div> -->

<!-- 							<div class="row g-2 align-items-center mb-2 size_row"> -->
<!-- 								<div class="col-auto fw-bold" style="width: 100px;">歐規 -->
<!-- 									200cm</div> -->
<!-- 								<th:block th:each="size : ${allSizes}" -->
<!-- 									th:if="${size.width == width && size.length == 200}"> -->
<!-- 									<input type="hidden" name="sizeId" th:value="${size.sizeId}" /> -->
<!-- 									<div class="col-2"> -->
<!-- 										<span class="fw-bold" -->
<!-- 											th:text="${configMap != null && configMap[size.sizeId] != null ? '庫存:' + configMap[size.sizeId].stock : '庫存:0'}"> -->
<!-- 										</span> -->
<!-- 									</div> -->
<!-- 									<div class="col-3"> -->
<!-- 										<span class="text-primary fw-bold" -->
<!-- 											th:text="${configMap != null && configMap[size.sizeId] != null ? '$' + configMap[size.sizeId].price : '未定價'}"> -->
<!-- 										</span> -->
<!-- 									</div> -->
<!-- 								</th:block> -->
<!-- 							</div> -->

<!-- 							<div class="row g-2 align-items-center mb-2 size_row"> -->
<!-- 								<div class="col-auto fw-bold" style="width: 100px;">加長 -->
<!-- 									210cm</div> -->
<!-- 								<th:block th:each="size : ${allSizes}" -->
<!-- 									th:if="${size.width == width && size.length == 210}"> -->
<!-- 									<input type="hidden" name="sizeId" th:value="${size.sizeId}" /> -->
<!-- 									<div class="col-2"> -->
<!-- 										<span class="fw-bold" -->
<!-- 											th:text="${configMap != null && configMap[size.sizeId] != null ? '庫存:' + configMap[size.sizeId].stock : '庫存:0'}"> -->
<!-- 										</span> -->
<!-- 									</div> -->
<!-- 									<div class="col-3"> -->
<!-- 										<span class="text-primary fw-bold" -->
<!-- 											th:text="${configMap != null && configMap[size.sizeId] != null ? '$' + configMap[size.sizeId].price : '未定價'}"> -->
<!-- 										</span> -->
<!-- 									</div> -->
<!-- 								</th:block> -->
<!-- 							</div> -->
<!-- 						</div> -->

<!-- 						<div id="no_width_msg" class="text-muted small py-3">請先選擇上方寬度以設定規格內容</div> -->
<!-- 					</div> -->
					<!-- 測試用商品庫存價格 -->
					<div class="row">
						<th:block th:each="entry : ${configMap}">
							<th:block th:if="${entry.key == 1 or entry.key == 10}">
								<div class="col-6 border p-3">
									<p>
										<strong>尺寸 ID: <span th:text="${entry.key}"></span></strong><br>
										商品價格: <span th:text="${entry.value.price}"></span><br>
										剩餘庫存: <span th:text="${entry.value.stock}"></span>
									</p>
								</div>
							<input type="hidden" name="memberId"
								th:value="${session.memberId}">
							<input type="number" name="quantity">
							<input type="hidden" name="stock"
								th:value="${entry.value.stock}">
							<input type="hidden" name="price"
								th:value="${entry.value.price}">
							<input type="hidden" name="sizeId"
								th:value="${entry.key}">
							</th:block>
						</th:block>
					</div>
					<div class="mt-5 d-flex gap-3">
							<button type="submit"
								class="btn btn-primary btn-reverse px-4 fw-bold">
								<i class="bi bi-pencil-square me-1"></i>加入購物車
							</button>


						<a th:href="@{/prod/listAllProduct}"
							class="btn btn-outline-secondary px-4 fw-bold"> <i
							class="bi bi-arrow-left me-1"></i>返回列表
						</a>
					</div>
				</div>
			</div>
			</form>
		</section>

	</main>

	<!-- JS 套件 -->
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
	<script th:src="@{/js/product_save.js}"></script>
	<script th:inline="javascript">
		/*<![CDATA[*/
		var allSizes = /*[[${allSizes}]]*/[];
		console.log("尺寸資料已載入");
		/*]]>*/
	</script>
</body>
</html>
